<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>세계유산 갯벌 보호 캠페인</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #60a5fa; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #3b82f6; }

        body { font-family: 'Inter', sans-serif; }

        .carousel-slide-container {
            transition: transform 0.5s ease-in-out;
        }

        .hero-section {
            height: 60vh;
            min-height: 400px;
            position: relative; 
            overflow: hidden; 
            cursor: pointer; 
        }
        
        #hero-image-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
        }

        #hero-background-image {
            width: 100%; height: 100%;
            object-fit: cover; 
            filter: brightness(60%); 
        }

        #hero-overlay-text {
            position: absolute;
            inset: 0;
            z-index: 3; 
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.2); 
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .hero-section:hover #hero-overlay-text { opacity: 1; }

        .calendar-date:hover { cursor: pointer; background-color: #eff6ff; }
        
        .image-container-vertical {
            width: 100%;
            max-width: 490px;
            position: relative;
            padding-bottom: 65%; 
            height: 0; 
            margin: 0 auto;
            overflow: hidden;
            border-radius: 0.75rem;
            background-color: #e5e7eb;
        }

        .object-cover-fill {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover;
        }

        .editable-cell input {
            width: 100%;
            border: none;
            background: rgba(255, 255, 255, 0.5);
            outline: none;
            border-bottom: 1px dashed #ccc;
        }
        .editable-cell input:focus { border-bottom: 1px solid #3b82f6; background: #fff; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header id="hero-section-click" class="hero-section flex items-center justify-center p-4">
        <div id="hero-image-container">
            <img id="hero-background-image" src="" onerror="this.src='https://placehold.co/1200x800/60A5FA/FFFFFF?text=클릭하여+배경+사진+업로드'" alt="배경">
        </div>
        <input type="file" id="hero-file-input" accept="image/*" class="hidden">
        <div id="hero-overlay-text">배경 사진 변경 (클릭)</div>
        <div class="hero-content text-center max-w-2xl mx-auto relative z-10 pointer-events-none">
            <h1 class="text-5xl sm:text-6xl lg:text-7xl font-extrabold text-blue-100 mb-3" style="text-shadow: 2px 2px 10px rgba(0,0,0,0.5);">갯벌을 지켜주세요.</h1>
            <p class="text-xl sm:text-2xl text-white">버려진 굴 패각으로부터 갯벌을 보호합시다.</p>
        </div>
    </header>

    <section class="py-16 px-4 bg-white">
        <h2 class="text-3xl font-bold text-center mb-10 text-blue-700">실험 기록 및 사진</h2>
        <div class="relative max-w-5xl mx-auto">
            <div id="carousel-slides" class="flex overflow-hidden rounded-xl shadow-lg bg-gray-100 border">
                <div id="carousel-slide-container" class="flex w-full carousel-slide-container">
                    <div class="flex-none w-full p-8 md:p-12 space-y-4">
                        <h3 class="text-2xl font-semibold">1단계: 실험 환경 사진</h3>
                        <div class="image-container-vertical cursor-pointer group" onclick="document.getElementById('file-input-1').click()">
                            <img id="uploaded-image-1" src="" onerror="this.src='https://placehold.co/490x320/9CA3AF/FFFFFF?text=사진+업로드+클릭'" class="object-cover-fill">
                            <input type="file" id="file-input-1" accept="image/*" class="hidden">
                            <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center text-white opacity-0 group-hover:opacity-100 transition">사진 변경</div>
                        </div>
                    </div>
                    <div class="flex-none w-full p-8 md:p-12 space-y-4">
                        <h3 class="text-2xl font-semibold">2단계: 실험 결과 요약</h3>
                        <div class="p-6 bg-red-50 border border-red-300 rounded-lg h-64 flex flex-col justify-center">
                            <p class="font-bold text-red-700 text-xl mb-4">주요 관찰 내용</p>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li>실험군: 산소 농도 급격히 감소</li>
                                <li>대조군: 안정적인 생태계 유지</li>
                            </ul>
                        </div>
                    </div>
                    <div class="flex-none w-full p-8 md:p-12 space-y-4">
                        <h3 class="text-2xl font-semibold">3단계: 해결 방안 사진</h3>
                        <div class="image-container-vertical cursor-pointer group" onclick="document.getElementById('file-input-3').click()">
                            <img id="uploaded-image-3" src="" onerror="this.src='https://placehold.co/490x320/9CA3AF/FFFFFF?text=사진+업로드+클릭'" class="object-cover-fill">
                            <input type="file" id="file-input-3" accept="image/*" class="hidden">
                            <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center text-white opacity-0 group-hover:opacity-100 transition">사진 변경</div>
                        </div>
                    </div>
                </div>
            </div>
            <button id="prev-btn" class="absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 p-3 rounded-full shadow-lg">◀</button>
            <button id="next-btn" class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 p-3 rounded-full shadow-lg">▶</button>
        </div>
    </section>

    <section class="py-16 px-4 bg-gray-50">
        <div class="max-w-4xl mx-auto flex flex-col lg:flex-row gap-8">
            <div class="lg:w-1/2 bg-white p-6 rounded-xl shadow border">
                <h3 class="text-center font-bold mb-4">2025년 11월</h3>
                <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-center text-sm"></div>
            </div>
            <div class="lg:w-1/2 bg-white p-6 rounded-xl shadow border">
                <h3 id="data-date-display" class="font-bold text-blue-600 mb-4 text-center">날짜를 선택하세요</h3>
                <div id="experiment-data-display">
                    <table class="min-w-full text-sm">
                        <thead class="bg-gray-100">
                            <tr><th class="p-2">항목</th><th class="p-2">실험군</th><th class="p-2">대조1</th><th class="p-2">대조2</th></tr>
                        </thead>
                        <tbody id="data-table-body"></tbody>
                    </table>
                </div>
                <button id="save-data-btn" class="w-full mt-4 bg-green-500 text-white py-2 rounded font-bold hover:bg-green-600">수정 내용 저장</button>
            </div>
        </div>
    </section>

    <script>
        // --- 1. 이미지 압축 및 저장 로직 ---
        function handleImageUpload(file, key, imgId) {
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 800; 
                    let width = img.width, height = img.height;
                    if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; }
                    canvas.width = width; canvas.height = height;
                    canvas.getContext('2d').drawImage(img, 0, 0, width, height);
                    const base64 = canvas.toDataURL('image/jpeg', 0.7);
                    localStorage.setItem(key, base64);
                    document.getElementById(imgId).src = base64;
                    toast("사진이 저장되었습니다.");
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function loadImages() {
            const imgs = {'hero_img':'hero-background-image', 'step1_img':'uploaded-image-1', 'step3_img':'uploaded-image-3'};
            for(let k in imgs) { const s = localStorage.getItem(k); if(s) document.getElementById(imgs[k]).src = s; }
        }

        // --- 2. 데이터 관리 로직 ---
        let experimentData = JSON.parse(localStorage.getItem('mudflat_logs')) || {};
        let selectedDay = '2025-11-25';

        function renderTable() {
            const tbody = document.getElementById('data-table-body');
            const dayData = experimentData[selectedDay] || [
                { item: '온도', exp: '0', c1: '0', c2: '0' },
                { item: 'pH', exp: '0', c1: '0', c2: '0' },
                { item: '산소', exp: '0', c1: '0', c2: '0' },
                { item: '관찰', exp: '-', c1: '-', c2: '-' }
            ];
            tbody.innerHTML = dayData.map((row, i) => `
                <tr class="border-b">
                    <td class="p-2 font-bold">${row.item}</td>
                    <td class="p-2 editable-cell"><input type="text" value="${row.exp}" data-idx="${i}" data-f="exp"></td>
                    <td class="p-2 editable-cell"><input type="text" value="${row.c1}" data-idx="${i}" data-f="c1"></td>
                    <td class="p-2 editable-cell"><input type="text" value="${row.c2}" data-idx="${i}" data-f="c2"></td>
                </tr>
            `).join('');
            document.getElementById('data-date-display').textContent = selectedDay;
        }

        // --- 3. 이벤트 연결 ---
        document.getElementById('save-data-btn').onclick = () => {
            const inputs = document.querySelectorAll('#data-table-body input');
            const newData = [
                { item: '온도', exp: '', c1: '', c2: '' },
                { item: 'pH', exp: '', c1: '', c2: '' },
                { item: '산소', exp: '', c1: '', c2: '' },
                { item: '관찰', exp: '', c1: '', c2: '' }
            ];
            inputs.forEach(input => {
                const idx = input.dataset.idx;
                const field = input.dataset.f;
                newData[idx][field] = input.value;
            });
            experimentData[selectedDay] = newData;
            localStorage.setItem('mudflat_logs', JSON.stringify(experimentData));
            toast(selectedDay + " 데이터 저장 완료!");
        };

        // 이미지 업로드 클릭 이벤트
        document.getElementById('hero-section-click').onclick = () => document.getElementById('hero-file-input').click();
        document.getElementById('hero-file-input').onchange = (e) => handleImageUpload(e.target.files[0], 'hero_img', 'hero-background-image');
        document.getElementById('file-input-1').onchange = (e) => handleImageUpload(e.target.files[0], 'step1_img', 'uploaded-image-1');
        document.getElementById('file-input-3').onchange = (e) => handleImageUpload(e.target.files[0], 'step3_img', 'uploaded-image-3');

        // 달력 생성
        const grid = document.getElementById('calendar-grid');
        ['일','월','화','수','목','금','토'].forEach(d => grid.innerHTML += `<b>${d}</b>`);
        for(let i=1; i<=30; i++) {
            const dStr = `2025-11-${i.toString().padStart(2, '0')}`;
            const div = document.createElement('div');
            div.className = 'calendar-date p-2 rounded';
            div.textContent = i;
            div.onclick = () => { selectedDay = dStr; renderTable(); };
            grid.appendChild(div);
        }

        // 캐러셀
        let sIdx = 0;
        document.getElementById('next-btn').onclick = () => { if(sIdx < 2) sIdx++; move(); };
        document.getElementById('prev-btn').onclick = () => { if(sIdx > 0) sIdx--; move(); };
        function move() { document.getElementById('carousel-slide-container').style.transform = `translateX(-${sIdx*100}%)`; }

        function toast(m) {
            const t = document.createElement('div');
            t.className = 'fixed top-5 right-5 bg-blue-600 text-white p-4 rounded shadow-lg z-50';
            t.textContent = m;
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 2500);
        }

        window.onload = () => { loadImages(); renderTable(); };
    </script>
</body>
</html>
<index class="html"></index>
